<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Debug Test</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin: 5px 0; }
        button { background: #007aff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .debug { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>UI Debug Test - Post Reform</h1>
    
    <div class="form-group">
        <strong>Tax System:</strong><br>
        <label>
            <input type="radio" name="taxSystem" value="current" checked> Current System (2025-2027)
        </label>
        <label>
            <input type="radio" name="taxSystem" value="postReform"> Post-Reform System (2027+)
        </label>
    </div>
    
    <button onclick="testCalculation()">Test Calculation</button>
    <button onclick="testBoth()">Test Both Systems</button>
    
    <div id="debug"></div>
    <div id="results"></div>

    <script src="calculator.js"></script>
    <script>
        function testCalculation() {
            const taxSystemValue = document.querySelector('input[name="taxSystem"]:checked')?.value;
            const postReform = taxSystemValue === 'postReform';
            
            console.log('Tax system value:', taxSystemValue);
            console.log('PostReform boolean:', postReform);
            
            const params = {
                purchasePrice: 1000000,
                downPayment: 200000,
                mortgageRate: 0.015,
                annualMaintenanceCosts: 12500,
                amortizationYears: 10,
                annualAmortization: 16000,
                totalRenovations: 0,
                additionalPurchaseCosts: 20000,
                imputedRentalValue: 21000,
                propertyTaxDeductions: 10000,
                marginalTaxRate: 0.25,
                propertyAppreciationRate: 0.02,
                monthlyRent: 2700,
                annualRentalCosts: 5000,
                investmentYieldRate: 0.03,
                termYears: 10,
                scenarioMode: 'equalConsumption',
                postReform: postReform
            };
            
            console.log('Full params:', params);
            
            const result = SwissRentBuyCalculator.calculate(params);
            
            document.getElementById('debug').innerHTML = `
                <div class="debug">
                    <strong>Debug Info:</strong><br>
                    Selected radio: ${taxSystemValue}<br>
                    PostReform param: ${postReform}<br>
                    Result PostReform flag: ${result.PostReform}<br>
                    Tax difference: CHF ${Math.round(result.TaxDifferenceToRental).toLocaleString()}
                </div>
            `;
            
            document.getElementById('results').innerHTML = `
                <div class="result">
                    <strong>System:</strong> ${postReform ? 'Post-Reform (2027+)' : 'Current (2025-2027)'}<br>
                    <strong>Decision:</strong> ${result.Decision}<br>
                    <strong>Result Value:</strong> CHF ${Math.round(result.ResultValue).toLocaleString()}<br>
                    <strong>Year 1 Imputed Tax:</strong> CHF ${Math.round(result.YearlyBreakdown[0].taxImputedRent).toLocaleString()}<br>
                    <strong>Year 1 Interest Savings:</strong> CHF ${Math.round(result.YearlyBreakdown[0].taxSavingsInterest).toLocaleString()}
                </div>
            `;
        }
        
        function testBoth() {
            const baseParams = {
                purchasePrice: 1000000,
                downPayment: 200000,
                mortgageRate: 0.015,
                annualMaintenanceCosts: 12500,
                amortizationYears: 10,
                annualAmortization: 16000,
                totalRenovations: 0,
                additionalPurchaseCosts: 20000,
                imputedRentalValue: 21000,
                propertyTaxDeductions: 10000,
                marginalTaxRate: 0.25,
                propertyAppreciationRate: 0.02,
                monthlyRent: 2700,
                annualRentalCosts: 5000,
                investmentYieldRate: 0.03,
                termYears: 10,
                scenarioMode: 'equalConsumption'
            };
            
            const currentResult = SwissRentBuyCalculator.calculate({ ...baseParams, postReform: false });
            const postReformResult = SwissRentBuyCalculator.calculate({ ...baseParams, postReform: true });
            
            document.getElementById('results').innerHTML = `
                <div class="result">
                    <strong>Current System:</strong><br>
                    Decision: ${currentResult.Decision}, Value: CHF ${Math.round(currentResult.ResultValue).toLocaleString()}<br>
                    Imputed Tax: CHF ${Math.round(currentResult.YearlyBreakdown[0].taxImputedRent).toLocaleString()}, 
                    Interest Savings: CHF ${Math.round(currentResult.YearlyBreakdown[0].taxSavingsInterest).toLocaleString()}
                </div>
                <div class="result">
                    <strong>Post-Reform System:</strong><br>
                    Decision: ${postReformResult.Decision}, Value: CHF ${Math.round(postReformResult.ResultValue).toLocaleString()}<br>
                    Imputed Tax: CHF ${Math.round(postReformResult.YearlyBreakdown[0].taxImputedRent).toLocaleString()}, 
                    Interest Savings: CHF ${Math.round(postReformResult.YearlyBreakdown[0].taxSavingsInterest).toLocaleString()}
                </div>
                <div class="debug">
                    <strong>Difference:</strong> CHF ${Math.round(postReformResult.ResultValue - currentResult.ResultValue).toLocaleString()}
                </div>
            `;
        }
    </script>
</body>
</html>