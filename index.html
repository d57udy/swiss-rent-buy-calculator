<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swiss Rent vs Buy Calculator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
            color: #1d1d1f;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #1d1d1f;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #d2d2d7;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            color: #86868b;
            font-size: 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #007aff;
            border-bottom-color: #007aff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .form-section h3 {
            margin: 0 0 20px 0;
            color: #1d1d1f;
            font-size: 18px;
            border-bottom: 2px solid #007aff;
            padding-bottom: 8px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        
        .input-label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1d1d1f;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 8px;
            cursor: help;
        }
        
        .tooltip .info-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #007aff;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 12px;
            line-height: 16px;
            font-weight: bold;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            line-height: 1.4;
            font-weight: normal;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .input-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .checkbox-container input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .checkbox-container label {
            font-size: 14px;
            color: #666;
            font-weight: normal;
        }
        
        input[type="number"], select {
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            width: 100%;
            max-width: 300px;
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #007aff;
        }
        
        input[type="number"]:disabled {
            background-color: #f5f5f5;
            color: #999;
        }
        
        .unit {
            color: #666;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .button {
            background: #007aff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }
        
        .button:hover {
            background: #0056b3;
        }
        
        .button.secondary {
            background: #f2f2f7;
            color: #1d1d1f;
        }
        
        .button.secondary:hover {
            background: #e5e5ea;
        }
        
        .results {
            background: #f2f2f7;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #d2d2d7;
        }
        
        .result-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 18px;
        }
        
        .decision-buy {
            color: #34c759;
        }
        
        .decision-rent {
            color: #ff3b30;
        }
        
        .decision-even {
            color: #ff9500;
        }
        
        .pivot-table {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        .pivot-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .pivot-table th, .pivot-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #d2d2d7;
        }
        
        .pivot-table th {
            background: #f2f2f7;
            font-weight: 600;
        }
        
        .cell-buy {
            background: rgba(52, 199, 89, 0.2);
        }
        
        .cell-rent {
            background: rgba(255, 59, 48, 0.2);
        }
        
        .cell-even {
            background: rgba(255, 149, 0, 0.2);
        }
        
        .loading {
            text-align: center;
            color: #86868b;
            padding: 20px;
        }
        
        .sweep-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .sweep-param {
            background: #f2f2f7;
            padding: 20px;
            border-radius: 8px;
        }
        
        .sweep-param h4 {
            margin: 0 0 15px 0;
            color: #1d1d1f;
        }
        
        .range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .range-inputs input {
            padding: 8px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .range-inputs {
                grid-template-columns: 1fr;
            }
            
            .tooltip .tooltiptext {
                width: 250px;
                margin-left: -125px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Swiss Rent vs Buy Calculator</h1>
        
        <div class="tab-container">
            <button class="tab active" data-tab="single">Single Calculation</button>
            <button class="tab" data-tab="breakeven">Max Bid Finder</button>
            <button class="tab" data-tab="sweep">Parameter Sweep</button>
            <button class="tab" data-tab="about">About</button>
        </div>
        
        <!-- Single Calculation Tab -->
        <div class="tab-content active" id="single">
            <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #007aff;">
                <p style="margin: 0; color: #1d1d1f; line-height: 1.5;">Calculate whether renting or buying a property makes more financial sense for your situation. This tool analyzes all costs, tax implications, and investment opportunities over your chosen time period to help you make an informed decision.</p>
            </div>
            <!-- Purchase Parameters Section -->
            <div class="form-section">
                <h3>Purchase Parameters</h3>
                
                <div class="input-group">
                    <div class="input-label">
                        Purchase Price
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">The total price you would pay to purchase the property, including all costs.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="purchasePrice" value="2000000" step="1000" min="0">
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Down Payment
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">The amount of equity you invest upfront. In Switzerland, typically 20% minimum is required, with at least 10% from your own funds.</span>
                        </div>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="autoDownPayment" checked>
                        <label for="autoDownPayment">Calculate automatically (20% of purchase price)</label>
                    </div>
                    <div class="input-container">
                        <input type="number" id="downPayment" value="400000" step="1000" min="0" disabled>
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Additional Purchase Costs
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Additional costs when buying: notary fees, land registry, real estate agent commission, taxes. Typically 1-3% of purchase price.</span>
                        </div>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="autoAdditionalCosts" checked>
                        <label for="autoAdditionalCosts">Calculate automatically (2% of purchase price)</label>
                    </div>
                    <div class="input-container">
                        <input type="number" id="additionalPurchaseCosts" value="40000" step="1000" min="0" disabled>
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Total Renovations
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">One-time renovation and improvement costs over the analysis period.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="totalRenovations" value="0" step="1000" min="0">
                        <span class="unit">CHF</span>
                    </div>
                </div>
            </div>
            
            <!-- Mortgage Parameters Section -->
            <div class="form-section">
                <h3>Mortgage Parameters</h3>
                
                <div class="input-group">
                    <div class="input-label">
                        Mortgage Interest Rate
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Annual interest rate for your mortgage. Current Swiss rates typically range from 0.5% to 3%.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="mortgageRate" value="0.9" step="0.1" min="0">
                        <span class="unit">% per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Amortization Period
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Period over which you pay down the mortgage. Swiss regulations require amortization to 65% LTV within 15 years.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="amortizationYears" value="10" step="1" min="1" max="20">
                        <span class="unit">years</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Annual Amortization Amount
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Annual amount paid to reduce mortgage principal. Calculated as mortgage amount divided by amortization period.</span>
                        </div>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="autoAmortization" checked>
                        <label for="autoAmortization">Calculate automatically (mortgage ÷ amortization period)</label>
                    </div>
                    <div class="input-container">
                        <input type="number" id="annualAmortization" value="32000" step="1000" min="0" disabled>
                        <span class="unit">CHF per year</span>
                    </div>
                </div>
            </div>
            
            <!-- Property Costs Section -->
            <div class="form-section">
                <h3>Property Costs</h3>
                
                <div class="input-group">
                    <div class="input-label">
                        Annual Maintenance Costs
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Annual costs for property maintenance, repairs, and upkeep. Typically 1-1.5% of property value per year.</span>
                        </div>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="autoMaintenance" checked>
                        <label for="autoMaintenance">Calculate automatically (1.25% of purchase price)</label>
                    </div>
                    <div class="input-container">
                        <input type="number" id="annualMaintenanceCosts" value="25000" step="1000" min="0" disabled>
                        <span class="unit">CHF per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Property Appreciation Rate
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Expected annual increase in property value. Swiss real estate has historically appreciated 1-3% annually.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="propertyAppreciation" value="1.0" step="0.1" min="-5" max="10">
                        <span class="unit">% per year</span>
                    </div>
                </div>
            </div>
            
            <!-- Tax Parameters Section -->
            <div class="form-section">
                <h3>Tax Parameters</h3>
                
                <div class="input-group">
                    <div class="input-label">
                        Imputed Rental Value
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Taxable benefit of living in your own property. Swiss tax authorities typically assess this at 60-70% of market rent.</span>
                        </div>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="autoImputedRental" checked>
                        <label for="autoImputedRental">Calculate automatically (65% of annual rent)</label>
                    </div>
                    <div class="input-container">
                        <input type="number" id="imputedRentalValue" value="42900" step="1000" min="0" disabled>
                        <span class="unit">CHF per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Property Tax Deductions
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Annual tax-deductible expenses for property ownership: maintenance, repairs, mortgage interest, insurance, utilities.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="propertyTaxDeductions" value="13000" step="1000" min="0">
                        <span class="unit">CHF per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Marginal Tax Rate
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Your marginal tax rate (federal + cantonal + municipal). Varies by canton and income level, typically 15-45%.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="marginalTaxRate" value="23.6" step="0.1" min="0" max="50">
                        <span class="unit">%</span>
                    </div>
                </div>
            </div>
            
            <!-- Rental Parameters Section -->
            <div class="form-section">
                <h3>Rental Parameters</h3>
                
                <div class="input-group">
                    <div class="input-label">
                        Monthly Rent
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Monthly rent for a comparable property. This is the alternative to buying.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="monthlyRent" value="5500" step="100" min="0">
                        <span class="unit">CHF per month</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Annual Rental Costs
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Additional annual costs when renting: utilities, insurance, small repairs not covered by landlord.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="annualRentalCosts" value="20000" step="1000" min="0">
                        <span class="unit">CHF per year</span>
                    </div>
                </div>
            </div>
            
            <!-- Investment Parameters Section -->
            <div class="form-section">
                <h3>Investment Parameters</h3>
                
                <div class="input-group">
                    <div class="input-label">
                        Investment Yield Rate
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Expected annual return on alternative investments (stocks, bonds, funds) if you rent instead of buying.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="investmentYield" value="3.5" step="0.1" min="0" max="15">
                        <span class="unit">% per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">
                        Analysis Period
                        <div class="tooltip">
                            <span class="info-icon">i</span>
                            <span class="tooltiptext">Time horizon for the rent vs buy comparison. Typically 5-15 years to account for transaction costs and market cycles.</span>
                        </div>
                    </div>
                    <div class="input-container">
                        <input type="number" id="termYears" value="10" step="1" min="1" max="30">
                        <span class="unit">years</span>
                    </div>
                </div>
            </div>
            
            <button class="button" id="calculateBtn">Calculate</button>
            
            <div id="singleResults" class="results" style="display: none;"></div>
        </div>
        
        <!-- Max Bid Finder Tab -->
        <div class="tab-content" id="breakeven">
            <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #007aff;">
                <p style="margin: 0; color: #1d1d1f; line-height: 1.5;">Find the maximum price you should bid for a property to break even with renting. This tool uses binary search to identify the purchase price where buying and renting have equal total costs, helping you set realistic bidding limits.</p>
            </div>
            <div class="form-section">
                <h3>Search Parameters</h3>
                
                <div class="input-group">
                    <div class="input-label">Monthly Rent</div>
                    <div class="input-container">
                        <input type="number" id="beMonthlyRent" value="5500" step="100">
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Mortgage Rate</div>
                    <div class="input-container">
                        <input type="number" id="beMortgageRate" value="0.9" step="0.1" min="0">
                        <span class="unit">%</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Property Appreciation</div>
                    <div class="input-container">
                        <input type="number" id="bePropertyAppreciation" value="1.0" step="0.1">
                        <span class="unit">% per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Investment Yield</div>
                    <div class="input-container">
                        <input type="number" id="beInvestmentYield" value="3.5" step="0.1">
                        <span class="unit">% per year</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Fixed Mortgage Amount</div>
                    <div class="input-container">
                        <input type="number" id="beMortgageAmount" value="1653000" step="1000">
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Min Search Price</div>
                    <div class="input-container">
                        <input type="number" id="beMinPrice" value="1500000" step="10000">
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Max Search Price</div>
                    <div class="input-container">
                        <input type="number" id="beMaxPrice" value="3000000" step="10000">
                        <span class="unit">CHF</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-label">Tolerance</div>
                    <div class="input-container">
                        <input type="number" id="beTolerance" value="2500" step="500">
                        <span class="unit">CHF</span>
                    </div>
                </div>
            </div>
            
            <button class="button" id="breakevenBtn">Find Max Bid Price</button>
            
            <div id="breakevenResults" class="results" style="display: none;"></div>
        </div>
        
        <!-- Parameter Sweep Tab -->
        <div class="tab-content" id="sweep">
            <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #007aff;">
                <p style="margin: 0; color: #1d1d1f; line-height: 1.5;">Analyze how changing market conditions affect the rent vs buy decision. This tool runs multiple scenarios across different property appreciation rates, investment yields, and mortgage rates, displaying results in an interactive color-coded table.</p>
            </div>
            <h3>Parameter Sweep Configuration</h3>
            
            <div class="sweep-controls">
                <div class="sweep-param">
                    <h4>Property Appreciation (%/year)</h4>
                    <div class="range-inputs">
                        <input type="number" id="propAppMin" placeholder="Min" value="0" step="0.5">
                        <input type="number" id="propAppMax" placeholder="Max" value="3" step="0.5">
                        <input type="number" id="propAppStep" placeholder="Step" value="0.5" step="0.1">
                    </div>
                </div>
                
                <div class="sweep-param">
                    <h4>Investment Yield (%/year)</h4>
                    <div class="range-inputs">
                        <input type="number" id="invYieldMin" placeholder="Min" value="2" step="0.5">
                        <input type="number" id="invYieldMax" placeholder="Max" value="5" step="0.5">
                        <input type="number" id="invYieldStep" placeholder="Step" value="0.5" step="0.1">
                    </div>
                </div>
                
                <div class="sweep-param">
                    <h4>Mortgage Rate (%)</h4>
                    <div class="range-inputs">
                        <input type="number" id="mortRateMin" placeholder="Min" value="0.5" step="0.1">
                        <input type="number" id="mortRateMax" placeholder="Max" value="2.5" step="0.1">
                        <input type="number" id="mortRateStep" placeholder="Step" value="0.5" step="0.1">
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="button" id="sweepBtn">Run Parameter Sweep</button>
                <button class="button secondary" id="downloadCsvBtn" style="margin-left: 10px; display: none;">Download CSV</button>
            </div>
            
            <div id="sweepResults"></div>
        </div>
        
        <!-- About Tab -->
        <div class="tab-content" id="about">
            <div style="max-width: 800px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #007aff; margin-bottom: 10px;">Swiss Rent vs Buy Calculator</h2>
                    <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Version <span id="app-version">2.1.0</span></div>
                    <div style="color: #666; font-size: 14px;">Created by <strong>d57udy</strong></div>
                </div>

                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                    <h3 style="margin-top: 0; color: #1d1d1f;">Project Overview</h3>
                    <p style="line-height: 1.6; color: #333;">
                        This comprehensive financial calculator was created to facilitate informed home purchase decisions in Switzerland. 
                        It provides sophisticated analysis tools beyond traditional rent vs buy calculators, helping you make one of 
                        life's most important financial decisions with confidence.
                    </p>
                </div>

                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                    <h3 style="margin-top: 0; color: #1d1d1f;">Inspiration & Enhanced Functionality</h3>
                    <p style="line-height: 1.6; color: #333; margin-bottom: 15px;">
                        Originally inspired by the excellent <a href="https://www.moneyland.ch/en/rent-or-buy-calculator" 
                        target="_blank" style="color: #007aff; text-decoration: none;">moneyland.ch rent vs buy calculator</a>, 
                        this tool extends the basic analysis with powerful additional features:
                    </p>
                    <ul style="line-height: 1.6; color: #333; padding-left: 20px;">
                        <li><strong>Maximum Bid Price Finder:</strong> Determine the highest price you should bid for a property to break even with renting</li>
                        <li><strong>Parameter Sweep Analysis:</strong> Test hundreds of market scenarios to understand decision sensitivity</li>
                        <li><strong>Swiss-Specific Modeling:</strong> Accurate tax calculations, mortgage regulations, and market standards</li>
                        <li><strong>Comprehensive Testing:</strong> Extensively tested calculation logic and Swiss financial modeling</li>
                        <li><strong>Export Capabilities:</strong> Download detailed results for further analysis in Excel or other tools</li>
                    </ul>
                </div>


                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                    <h3 style="margin-top: 0; color: #1d1d1f;">Open Source & Transparent</h3>
                    <p style="line-height: 1.6; color: #333; margin-bottom: 15px;">
                        This calculator is completely open source under the <strong>Creative Commons Attribution-ShareAlike 4.0 International License (CC BY-SA 4.0)</strong>. 
                        You can review the complete source code, calculation methodology, and validation testing to understand exactly how your 
                        financial analysis is performed.
                    </p>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
                        <h4 style="margin: 0 0 10px 0; color: #1976d2; font-size: 16px;">License Terms - You are free to:</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #333; line-height: 1.5;">
                            <li><strong>Share:</strong> Copy and redistribute in any medium or format</li>
                            <li><strong>Adapt:</strong> Remix, transform, and build upon the material</li>
                        </ul>
                        <h4 style="margin: 15px 0 10px 0; color: #1976d2; font-size: 16px;">Under these conditions:</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #333; line-height: 1.5;">
                            <li><strong>Attribution:</strong> Credit d57udy and link to this site</li>
                            <li><strong>ShareAlike:</strong> Distribute derivatives under the same license</li>
                        </ul>
                    </div>
                    <div style="text-align: center;">
                        <a href="https://github.com/yourusername/swiss-rent-buy-calculator" target="_blank" 
                           style="display: inline-block; background: #007aff; color: white; padding: 10px 20px; 
                                  border-radius: 6px; text-decoration: none; font-weight: 600; margin-right: 10px;">
                            📁 View Source Code
                        </a>
                        <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" 
                           style="display: inline-block; background: #ff9800; color: white; padding: 10px 20px; 
                                  border-radius: 6px; text-decoration: none; font-weight: 600;">
                            📜 View License
                        </a>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #007aff 0%, #0056b3 100%); padding: 25px; 
                            border-radius: 8px; color: white; text-align: center; margin-bottom: 25px;">
                    <h3 style="margin-top: 0; color: white;">Like this project?</h3>
                    <p style="line-height: 1.6; margin-bottom: 20px; opacity: 0.9;">
                        If this calculator has helped you make an informed property decision, consider sharing it 
                        with others or buying me a coffee to support continued development!
                    </p>
                    
                    <!-- Social Media Sharing -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: white; margin-bottom: 15px; font-size: 16px;">Share with others:</h4>
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20comprehensive%20Swiss%20Rent%20vs%20Buy%20Calculator!%20It%20helped%20me%20make%20an%20informed%20property%20decision.&url=https://yoursite.com" 
                               target="_blank" style="display: inline-block; background: rgba(255,255,255,0.2); color: white; 
                                      padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;
                                      border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; font-size: 14px;">
                                🐦 Twitter
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://yoursite.com" 
                               target="_blank" style="display: inline-block; background: rgba(255,255,255,0.2); color: white; 
                                      padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;
                                      border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; font-size: 14px;">
                                💼 LinkedIn
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u=https://yoursite.com" 
                               target="_blank" style="display: inline-block; background: rgba(255,255,255,0.2); color: white; 
                                      padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;
                                      border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; font-size: 14px;">
                                📘 Facebook
                            </a>
                            <a href="https://reddit.com/submit?url=https://yoursite.com&title=Swiss%20Rent%20vs%20Buy%20Calculator" 
                               target="_blank" style="display: inline-block; background: rgba(255,255,255,0.2); color: white; 
                                      padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;
                                      border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; font-size: 14px;">
                                🤖 Reddit
                            </a>
                        </div>
                    </div>
                    
                    <!-- Buy Me a Coffee -->
                    <div>
                        <h4 style="color: white; margin-bottom: 15px; font-size: 16px;">Support development:</h4>
                        <a href="https://www.buymeacoffee.com/d57udy" target="_blank" 
                           style="display: inline-block; background: #FFDD00; color: #000; 
                                  padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600;
                                  border: none; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            ☕ Buy me a coffee
                        </a>
                    </div>
                    
                    <p style="font-size: 13px; margin-top: 15px; margin-bottom: 0; opacity: 0.8;">
                        Your support helps keep this tool free and continuously improved.
                    </p>
                </div>

                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                    <h3 style="margin-top: 0; color: #1d1d1f;">Important Disclaimer</h3>
                    <p style="line-height: 1.6; color: #666; font-size: 14px; margin-bottom: 15px;">
                        This calculator is designed for <strong>educational and planning purposes only</strong> and is 
                        <strong>not professional financial advice</strong>. While extensively validated against industry 
                        standards, <strong>there are no guarantees</strong> regarding the accuracy of calculations or 
                        their applicability to your specific situation.
                    </p>
                    <p style="line-height: 1.6; color: #666; font-size: 14px; margin-bottom: 15px;">
                        Always consult qualified professionals including real estate agents, mortgage brokers, tax advisors, 
                        and financial planners before making property purchase decisions. The authors assume no liability 
                        for financial decisions made based on this tool.
                    </p>
                    <p style="line-height: 1.6; color: #333; font-size: 14px; margin-bottom: 0; text-align: center; 
                       font-style: italic;">
                        This tool was built with ❤️ to help the Swiss community make informed real estate decisions.
                    </p>
                </div>

                <div style="text-align: center; color: #999; font-size: 12px; border-top: 1px solid #eee; 
                            margin-top: 30px; padding-top: 20px;">
                    <p style="margin: 0 0 10px 0;">
                        Swiss Rent vs Buy Calculator v<span id="footer-version">2.1.0</span> • 
                        Created with ❤️ for the Swiss real estate community<br>
                        Independent implementation • Not affiliated with moneyland.ch or any Swiss financial institution
                    </p>
                    <p style="margin: 0; font-size: 11px;">
                        Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" 
                        style="color: #007aff; text-decoration: none;">CC BY-SA 4.0</a> • 
                        Attribution required • ShareAlike derivatives
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="calculator.js"></script>
    <script>
        // Auto-calculation functions
        function updateCalculatedFields() {
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value) || 0;
            const mortgageAmount = purchasePrice - (parseFloat(document.getElementById('downPayment').value) || 0);
            const amortizationYears = parseFloat(document.getElementById('amortizationYears').value) || 10;
            
            // Auto down payment (20%)
            if (document.getElementById('autoDownPayment').checked) {
                document.getElementById('downPayment').value = Math.round(purchasePrice * 0.2);
                document.getElementById('downPayment').disabled = true;
            } else {
                document.getElementById('downPayment').disabled = false;
            }
            
            // Auto additional costs (2%)
            if (document.getElementById('autoAdditionalCosts').checked) {
                document.getElementById('additionalPurchaseCosts').value = Math.round(purchasePrice * 0.02);
                document.getElementById('additionalPurchaseCosts').disabled = true;
            } else {
                document.getElementById('additionalPurchaseCosts').disabled = false;
            }
            
            // Auto maintenance (1.25%)
            if (document.getElementById('autoMaintenance').checked) {
                document.getElementById('annualMaintenanceCosts').value = Math.round(purchasePrice * 0.0125);
                document.getElementById('annualMaintenanceCosts').disabled = true;
            } else {
                document.getElementById('annualMaintenanceCosts').disabled = false;
            }
            
            // Auto amortization
            if (document.getElementById('autoAmortization').checked) {
                const currentMortgage = purchasePrice - (parseFloat(document.getElementById('downPayment').value) || 0);
                document.getElementById('annualAmortization').value = Math.round(currentMortgage / amortizationYears);
                document.getElementById('annualAmortization').disabled = true;
            } else {
                document.getElementById('annualAmortization').disabled = false;
            }
            
            // Auto imputed rental (65% of annual rent)
            if (document.getElementById('autoImputedRental').checked) {
                document.getElementById('imputedRentalValue').value = Math.round(monthlyRent * 12 * 0.65);
                document.getElementById('imputedRentalValue').disabled = true;
            } else {
                document.getElementById('imputedRentalValue').disabled = false;
            }
        }
        
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });

        // Auto-calculation event listeners
        document.getElementById('purchasePrice').addEventListener('input', updateCalculatedFields);
        document.getElementById('downPayment').addEventListener('input', updateCalculatedFields);
        document.getElementById('monthlyRent').addEventListener('input', updateCalculatedFields);
        document.getElementById('amortizationYears').addEventListener('input', updateCalculatedFields);
        
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateCalculatedFields);
        });

        // Single calculation
        document.getElementById('calculateBtn').addEventListener('click', () => {
            const params = {
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                downPayment: parseFloat(document.getElementById('downPayment').value),
                mortgageRate: parseFloat(document.getElementById('mortgageRate').value) / 100,
                monthlyRent: parseFloat(document.getElementById('monthlyRent').value),
                propertyAppreciationRate: parseFloat(document.getElementById('propertyAppreciation').value) / 100,
                investmentYieldRate: parseFloat(document.getElementById('investmentYield').value) / 100,
                marginalTaxRate: parseFloat(document.getElementById('marginalTaxRate').value) / 100,
                termYears: parseInt(document.getElementById('termYears').value),
                annualMaintenanceCosts: parseFloat(document.getElementById('annualMaintenanceCosts').value),
                amortizationYears: parseInt(document.getElementById('amortizationYears').value),
                annualAmortization: parseFloat(document.getElementById('annualAmortization').value),
                totalRenovations: parseFloat(document.getElementById('totalRenovations').value),
                additionalPurchaseCosts: parseFloat(document.getElementById('additionalPurchaseCosts').value),
                imputedRentalValue: parseFloat(document.getElementById('imputedRentalValue').value),
                propertyTaxDeductions: parseFloat(document.getElementById('propertyTaxDeductions').value),
                annualRentalCosts: parseFloat(document.getElementById('annualRentalCosts').value)
            };

            const result = SwissRentBuyCalculator.calculate(params);
            displaySingleResult(result);
        });

        function displaySingleResult(result) {
            const resultsDiv = document.getElementById('singleResults');
            const decisionClass = result.Decision.toLowerCase();
            
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 8px; border-left: 4px solid ${decisionClass === 'buy' ? '#34c759' : decisionClass === 'rent' ? '#ff3b30' : '#ff9500'};">
                    <div class="result-item decision-${decisionClass}" style="font-size: 18px; font-weight: 600; margin-bottom: 10px; border-bottom: none;">
                        <span>Decision: ${result.Decision}</span>
                        <span>${result.ResultValue > 0 ? '+' : ''}CHF ${Math.round(Math.abs(result.ResultValue)).toLocaleString()}</span>
                    </div>
                    <div style="font-size: 16px; line-height: 1.4;">
                        <strong>${result.CompareText}</strong>
                    </div>
                </div>
                <div class="result-item">
                    <span>Purchase Price:</span>
                    <span>CHF ${result.PurchasePrice.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Down Payment:</span>
                    <span>CHF ${result.DownPayment.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Mortgage Amount:</span>
                    <span>CHF ${result.MortgageAmount.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Interest Costs (${result.TermYears} years):</span>
                    <span>CHF ${Math.round(result.InterestCosts).toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Total Purchase Cost:</span>
                    <span>CHF ${Math.round(result.TotalPurchaseCost).toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Total Rental Cost:</span>
                    <span>CHF ${Math.round(result.TotalRentalCost).toLocaleString()}</span>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        // Break-even finder
        document.getElementById('breakevenBtn').addEventListener('click', () => {
            const mortgageAmount = parseFloat(document.getElementById('beMortgageAmount').value);
            const params = {
                monthlyRent: parseFloat(document.getElementById('beMonthlyRent').value),
                mortgageRate: parseFloat(document.getElementById('beMortgageRate').value) / 100,
                propertyAppreciationRate: parseFloat(document.getElementById('bePropertyAppreciation').value) / 100,
                investmentYieldRate: parseFloat(document.getElementById('beInvestmentYield').value) / 100,
                marginalTaxRate: 0.236,
                termYears: 10,
                mortgageAmount: mortgageAmount,
                annualMaintenanceCosts: 25000,
                amortizationYears: 10,
                annualAmortization: 22199,
                totalRenovations: 0,
                additionalPurchaseCosts: 0,
                propertyTaxDeductions: 13000,
                annualRentalCosts: 20000
            };

            params.imputedRentalValue = Math.round(0.65 * 12 * params.monthlyRent);

            const options = {
                minPrice: parseFloat(document.getElementById('beMinPrice').value),
                maxPrice: parseFloat(document.getElementById('beMaxPrice').value),
                tolerance: parseFloat(document.getElementById('beTolerance').value)
            };

            const result = SwissRentBuyCalculator.findBreakevenPrice(params, options);
            displayBreakevenResult(result);
        });

        function displayBreakevenResult(result) {
            const resultsDiv = document.getElementById('breakevenResults');
            
            if (result.breakevenFound) {
                resultsDiv.innerHTML = `
                    <div class="result-item">
                        <span>Max Bid Price:</span>
                        <span>CHF ${result.breakevenPrice.toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span>Required Down Payment:</span>
                        <span>CHF ${result.downPayment.toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span>Loan-to-Value Ratio:</span>
                        <span>${result.ltvPercent.toFixed(1)}%</span>
                    </div>
                    <div class="result-item">
                        <span>NPV Difference:</span>
                        <span>CHF ${Math.round(result.resultValue).toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span>Search Iterations:</span>
                        <span>${result.iterations}</span>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 8px;">
                        <strong>${result.message}</strong>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div style="padding: 15px; background: rgba(255, 59, 48, 0.1); border-radius: 8px; color: #ff3b30;">
                        <strong>${result.message}</strong>
                        <br>Search completed in ${result.iterations} iterations.
                    </div>
                `;
            }
            resultsDiv.style.display = 'block';
        }

        // Parameter sweep
        let sweepData = [];

        document.getElementById('sweepBtn').addEventListener('click', () => {
            const sweepBtn = document.getElementById('sweepBtn');
            const resultsDiv = document.getElementById('sweepResults');
            
            sweepBtn.textContent = 'Running...';
            sweepBtn.disabled = true;
            resultsDiv.innerHTML = '<div class="loading">Running parameter sweep...</div>';

            setTimeout(() => {
                try {
                    const baseParams = {
                        purchasePrice: 2000000,
                        downPayment: 400000,
                        monthlyRent: 5500,
                        marginalTaxRate: 0.236,
                        termYears: 10,
                        annualMaintenanceCosts: 25000,
                        amortizationYears: 10,
                        annualAmortization: 32000,
                        totalRenovations: 0,
                        additionalPurchaseCosts: 40000,
                        imputedRentalValue: Math.round(0.65 * 12 * 5500),
                        propertyTaxDeductions: 13000,
                        annualRentalCosts: 20000
                    };

                    const sweepRanges = {
                        propertyAppreciationRate: {
                            min: parseFloat(document.getElementById('propAppMin').value) / 100,
                            max: parseFloat(document.getElementById('propAppMax').value) / 100,
                            step: parseFloat(document.getElementById('propAppStep').value) / 100
                        },
                        investmentYieldRate: {
                            min: parseFloat(document.getElementById('invYieldMin').value) / 100,
                            max: parseFloat(document.getElementById('invYieldMax').value) / 100,
                            step: parseFloat(document.getElementById('invYieldStep').value) / 100
                        },
                        mortgageRate: {
                            min: parseFloat(document.getElementById('mortRateMin').value) / 100,
                            max: parseFloat(document.getElementById('mortRateMax').value) / 100,
                            step: parseFloat(document.getElementById('mortRateStep').value) / 100
                        }
                    };

                    sweepData = SwissRentBuyCalculator.parameterSweep(baseParams, sweepRanges);
                    displaySweepResults(sweepData);
                    
                    document.getElementById('downloadCsvBtn').style.display = 'inline-block';
                } catch (error) {
                    resultsDiv.innerHTML = `<div style="color: #ff3b30;">Error: ${error.message}</div>`;
                } finally {
                    sweepBtn.textContent = 'Run Parameter Sweep';
                    sweepBtn.disabled = false;
                }
            }, 100);
        });

        function displaySweepResults(data) {
            const resultsDiv = document.getElementById('sweepResults');
            
            if (data.length === 0) {
                resultsDiv.innerHTML = '<div>No results to display</div>';
                return;
            }

            const propRates = [...new Set(data.map(d => d.propertyAppreciationRate))].sort((a, b) => a - b);
            const invRates = [...new Set(data.map(d => d.investmentYieldRate))].sort((a, b) => a - b);
            
            let table = '<div class="pivot-table"><table><thead><tr><th>Property Appreciation \\ Investment Yield</th>';
            invRates.forEach(rate => {
                table += `<th>${(rate * 100).toFixed(1)}%</th>`;
            });
            table += '</tr></thead><tbody>';
            
            propRates.forEach(propRate => {
                table += `<tr><td><strong>${(propRate * 100).toFixed(1)}%</strong></td>`;
                invRates.forEach(invRate => {
                    const result = data.find(d => 
                        Math.abs(d.propertyAppreciationRate - propRate) < 0.001 && 
                        Math.abs(d.investmentYieldRate - invRate) < 0.001
                    );
                    
                    if (result) {
                        const cellClass = `cell-${result.Decision.toLowerCase()}`;
                        const value = result.ResultValue;
                        table += `<td class="${cellClass}">${result.Decision}<br>${value > 0 ? '+' : ''}${Math.round(value).toLocaleString()}</td>`;
                    } else {
                        table += '<td>-</td>';
                    }
                });
                table += '</tr>';
            });
            
            table += '</tbody></table></div>';
            
            resultsDiv.innerHTML = `
                <h4>Parameter Sweep Results (${data.length} combinations)</h4>
                <p>Colors: <span class="cell-buy" style="padding: 2px 8px; border-radius: 4px;">BUY</span> 
                <span class="cell-rent" style="padding: 2px 8px; border-radius: 4px;">RENT</span> 
                <span class="cell-even" style="padding: 2px 8px; border-radius: 4px;">EVEN</span></p>
                ${table}
            `;
        }

        // CSV download
        document.getElementById('downloadCsvBtn').addEventListener('click', () => {
            if (sweepData.length === 0) return;
            
            const csv = SwissRentBuyCalculator.resultsToCsv(sweepData);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `rent_vs_buy_sweep_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Initialize version numbering
        async function setVersionNumbers() {
            let version = '2.1.0'; // Fallback version
            
            try {
                // Attempt to fetch calculator.js and extract version from header
                const response = await fetch('calculator.js');
                const content = await response.text();
                
                // Look for @version tag in the header comment
                const versionMatch = content.match(/@version\s+(\d+\.\d+\.\d+)/);
                if (versionMatch) {
                    version = versionMatch[1];
                }
            } catch (error) {
                console.log('Could not extract version from calculator.js, using fallback:', version);
            }
            
            // Set version in About tab and footer
            const appVersionElement = document.getElementById('app-version');
            const footerVersionElement = document.getElementById('footer-version');
            
            if (appVersionElement) appVersionElement.textContent = version;
            if (footerVersionElement) footerVersionElement.textContent = version;
            
            // Also update page title to include version
            document.title = `Swiss Rent vs Buy Calculator v${version}`;
        }

        // Initialize
        setVersionNumbers();
        updateCalculatedFields();
        document.getElementById('calculateBtn').click();
    </script>
</body>
</html>